# Frontend - College Football Imperial Map

Next.js application that renders an interactive map showing college football territory ownership.

## Quick Start

```bash
npm install
npm run dev
```

Visit http://localhost:3000

## Project Structure

```
frontend/
├── src/
│   ├── app/                    # Next.js App Router
│   │   ├── api/               # API routes (serve JSON data)
│   │   │   ├── teams/         # GET /api/teams
│   │   │   ├── territory/     # GET /api/territory
│   │   │   └── games/         # GET /api/games
│   │   ├── layout.tsx         # Root layout
│   │   └── page.tsx           # Home page
│   │
│   ├── components/            # React components
│   │   └── Map.tsx           # Main MapLibre GL component
│   │
│   ├── lib/                   # Utilities
│   │   └── mapUtils.ts       # Map rendering, team colors, logo utils
│   │
│   └── types/                 # TypeScript type definitions
│       └── index.ts          # Domain types (Team, Territory, Game, etc.)
│
└── public/
    └── data/                  # Static data files (generated by backend)
        ├── teams.json
        ├── ownership.json
        ├── territory-centroids.json
        ├── ownership/2025/
        └── games/2025/
```

## Architecture

The frontend is a **read-only** static site that fetches data from JSON files:

```
┌─────────────────┐
│   Browser       │
│   (React)       │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│   Map.tsx       │  ← Main component
│   (MapLibre GL) │  ← Renders interactive map
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│   API Routes    │  ← Next.js API handlers
│   /api/teams    │  ← Serve teams.json
│   /api/territory│  ← Serve ownership snapshots
│   /api/games    │  ← Serve game results
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ public/data/    │  ← Static JSON files
│ *.json          │  ← Generated by backend
└─────────────────┘
```

## Key Components

### Map Component (`src/components/Map.tsx`)

The main interactive map component using MapLibre GL JS.

**Features:**
- Renders US counties colored by team ownership
- Displays team logos at territory centroids
- Shows ownership snapshots by season/week
- Responsive and zoom-aware logo rendering
- Week and season selector controls

**Props:**
- `className?: string` - CSS classes for the map container

### API Routes

#### `GET /api/teams`
Returns all FBS teams with locations and colors.

**Response:**
```json
[
  {
    "id": "team-ohio-state",
    "name": "Ohio State",
    "school": "Ohio State",
    "abbreviation": "OSU",
    "color": "#BB0000",
    "alt_color": "#666666",
    "logos": ["https://..."],
    "location": { "lat": 40.0, "lng": -83.0 }
  }
]
```

#### `GET /api/territory?season=2025&week=1`
Returns county ownership for a specific week.

**Query Parameters:**
- `season` (optional) - Season year, defaults to current
- `week` (optional) - Week number, defaults to 0 (baseline)

**Response:**
```json
{
  "01001": "team-auburn",
  "01003": "team-alabama",
  ...
}
```

#### `GET /api/games?season=2025&week=1`
Returns game results for a specific week.

**Query Parameters:**
- `season` (required) - Season year
- `week` (required) - Week number

**Response:**
```json
[
  {
    "id": 123456,
    "season": 2025,
    "week": 1,
    "home_team": "Ohio State",
    "away_team": "Michigan",
    "home_points": 42,
    "away_points": 27,
    "winner": "Ohio State"
  }
]
```

## Utilities

### `lib/mapUtils.ts`

**Key Functions:**

- `getTeamColor(teamId: string): string` - Get primary color for a team
- `getTeamAltColor(teamId: string): string` - Get alternate color
- `createTerritoryLayer(ownership: Ownership): LayerSpecification` - Create MapLibre layer for counties
- `createLogoLayer(centroids: TerritoryCentroid[]): LayerSpecification` - Create logo markers
- `loadTeamLogos(): Promise<void>` - Pre-load team logo images

## Type Definitions

### Core Types (`src/types/index.ts`)

```typescript
interface Team {
  id: string
  name: string
  school: string
  abbreviation: string
  color: string
  alt_color: string
  logos: string[]
  location: {
    lat: number
    lng: number
  }
}

interface Ownership {
  [countyFips: string]: string  // countyFips -> teamId
}

interface Game {
  id: number
  season: number
  week: number
  home_team: string
  away_team: string
  home_points: number
  away_points: number
  winner: string
}

interface TerritoryCentroid {
  fips: string
  team: string
  centroid: [number, number]  // [lng, lat]
  area: number
}
```

## Development

### Available Scripts

```bash
npm run dev          # Start development server (localhost:3000)
npm run build        # Build for production
npm run start        # Start production server
npm run lint         # Run ESLint
npm run type-check   # Run TypeScript compiler check
```

### Adding New Features

1. **Add new API route:**
   - Create `src/app/api/your-route/route.ts`
   - Export async `GET()` function
   - Return `NextResponse.json(data)`

2. **Add new component:**
   - Create `src/components/YourComponent.tsx`
   - Import and use in `page.tsx` or other components

3. **Add new types:**
   - Update `src/types/index.ts`
   - Export new interfaces

### Environment Variables

Create `.env.local` (optional):

```bash
# None required for basic operation
# All data is served from static JSON files
```

## Data Flow

### On Page Load

1. Browser requests `/`
2. Next.js renders `page.tsx`
3. `Map.tsx` component mounts
4. Fetches initial data:
   - `GET /api/teams` → teams with colors
   - `GET /api/territory?week=0` → baseline ownership
5. MapLibre GL renders the map

### On Week Change

1. User selects week from dropdown
2. Component fetches:
   - `GET /api/territory?season=2025&week=X`
3. Map updates county colors
4. Logos update based on new ownership

## Deployment

### Build Configuration

The app is configured for static export with Next.js:

- **Build command:** `npm run build`
- **Output directory:** `.next`
- **Framework:** Next.js 14 (App Router)

### Vercel Deployment

**Option 1: Deploy from `frontend/` directory**
1. Set Root Directory to `frontend` in Vercel dashboard
2. Build command: `npm run build`
3. Output directory: `.next`

**Option 2: Deploy from repository root**
1. Create `vercel.json` in root:
```json
{
  "buildCommand": "cd frontend && npm install && npm run build",
  "outputDirectory": "frontend/.next"
}
```

### Static Assets

All data files must be committed to git:
- `public/data/*.json` - Core data files
- `public/data/ownership/2025/*.json` - Weekly snapshots
- `public/data/games/2025/*.json` - Game results

Vercel serves these from the `public/` directory automatically.

## Offline Support

The frontend can be built and run without external API dependencies:

```bash
npm run build
npm run start
```

All data is bundled at build time from `public/data/`.

## Performance

- **Initial bundle size:** ~200KB (gzipped)
- **Map library:** MapLibre GL JS (~500KB)
- **Data files:** ~80KB per week snapshot
- **Logo loading:** Lazy-loaded on zoom

### Optimization Tips

1. **Pre-load current week only:** Fetch older weeks on-demand
2. **Logo caching:** Team logos cached by browser
3. **GeoJSON simplification:** County shapes pre-simplified
4. **Centroids pre-calculated:** No runtime geospatial math

## Tech Stack

- **Framework:** Next.js 14 (App Router)
- **Map:** MapLibre GL JS 4.7
- **Styling:** Tailwind CSS
- **Language:** TypeScript
- **Package Manager:** npm

## Troubleshooting

### Map not loading
- Check browser console for errors
- Verify `public/data/us-counties.geojson` exists
- Ensure API routes return valid JSON

### Logos not showing
- Check network tab for 404s on logo URLs
- Verify `territory-centroids.json` exists
- Check zoom level (logos only show at certain zoom levels)

### Week selector empty
- Verify `public/data/ownership/<season>/` directory exists
- Check that backend scripts have been run
- Ensure index.json files are present

## Contributing

When adding features:

1. Run type checking: `npm run type-check`
2. Run linting: `npm run lint`
3. Test build: `npm run build`
4. Update this README if adding new routes or components
