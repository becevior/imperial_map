# Backend Scripts

Python scripts for managing territory data. **No database required** - all data stored as JSON files.

## Setup

```bash
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

## Scripts

### `setup.py` - Initialize Data

Generates initial `teams.json` and `ownership.json` files:

```bash
python setup.py
```

**What it does:**
1. Creates `public/data/teams.json` with 20 teams
2. Calculates centroid for each of 3,221 counties
3. Assigns each county to nearest team
4. Saves to `public/data/ownership.json`

**Run this once** to set up the map.

### `ingest_games.py` - Fetch Game Results *(TODO)*

Fetch completed games from CollegeFootballData API:

```bash
python ingest_games.py --season 2024 --week 5
```

Updates `ownership.json` based on game results.

### `process_transfers.py` - Manual Territory Update *(TODO)*

Manually apply a game result:

```bash
python process_transfers.py --winner alabama --loser georgia
```

## Library Modules

### `lib/territory.py`
- `calculate_centroid()` - Get center point of county polygon
- `calculate_distance()` - Haversine distance between coordinates
- `assign_initial_ownership()` - Assign counties to nearest teams
- `TEAM_STADIUM_LOCATIONS` - Stadium coordinates for 20 teams

### `lib/game_engine.py`
- `process_game_result()` - Determine territory transfers
- `validate_ownership()` - Check data consistency

### `lib/db.py`
- `load_json()` / `save_json()` - File I/O helpers
- `load_teams()` / `save_teams()` - Team data
- `load_ownership()` / `save_ownership()` - Territory state
- `append_transfer()` - Log transfer history

## Data Files

All files in `public/data/`:

```
public/data/
├── us-counties.geojson  # Source data (3.1MB, committed)
├── teams.json           # Generated by setup.py
├── ownership.json       # Updated by game results
├── transfers.json       # Transfer history log
└── games/
    └── 2024-week-1.json # Game results by week
```

## Workflow

1. **Setup**: `python setup.py` (once)
2. **Update**: `python ingest_games.py --week X` (after games)
3. **Deploy**: `git add public/data && git commit && git push`
4. **Live**: Vercel auto-deploys updated map

## Environment Variables

Create `.env` file:

```
CFBD_API_KEY=your_api_key_here
```

Get API key from https://collegefootballdata.com
