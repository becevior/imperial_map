# Getting Started

Clean baseline setup. Follow these steps to get the map running.

## Current State

âœ… **Working:**
- Frontend Next.js app structure
- Map component (MapLibre GL)
- Python backend scripts
- 3,221 counties GeoJSON data

âŒ **Missing:**
- `teams.json` (generated by setup)
- `ownership.json` (generated by setup)

## Setup (5 minutes)

### 1. Backend - Generate Data Files

```bash
cd backend
python3 -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate
pip install -r requirements.txt
python setup.py
```

**Output:**
```
ğŸš€ Initializing data files...

ğŸ“‹ Step 1: Creating teams.json...
  âœ“ Created teams.json with 20 teams

ğŸ—ºï¸  Step 2: Processing county data...
ğŸ“ Step 3: Assigning initial ownership...
  ğŸ“Š Processing 3221 counties...
  ğŸ¯ Assigning 3221 counties to nearest teams...
  âœ“ Created ownership.json

  ğŸ“Š Territory distribution:
     texas           523 counties
     nebraska        297 counties
     oklahoma        243 counties
     ...
```

This creates:
- `public/data/teams.json` (20 teams)
- `public/data/ownership.json` (3,221 FIPS â†’ team_id mappings)

### 2. (Optional) Pull Game Results

To layer weekly territory changes, fetch completed FBS games from CollegeFootballData. Set `CFBD_API_KEY` in your environment (or `.env`) for higher rate limits.

```bash
python ingest_games.py --season 2025 --season-type both
```

Weekly summaries are stored under `frontend/public/data/games/2025/`.

### 3. (Optional) Apply Territory Transfers

Walk the ingested results and emit per-week ownership snapshots:

```bash
python apply_transfers.py --season 2025
```

Outputs land in `frontend/public/data/ownership/2025/` and updates the frontend index for the map dropdown.

### 4. Frontend - Run Dev Server

```bash
# In project root
npm install
npm run dev
```

Visit **http://localhost:3000**

You should see a map of the US with counties colored by team!

## Project Structure (Clean!)

```
imperial-map/
â”œâ”€â”€ backend/               # Python - data management
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ territory.py  # Geospatial calculations
â”‚   â”‚   â”œâ”€â”€ game_engine.py # Territory transfer logic
â”‚   â”‚   â””â”€â”€ db.py         # JSON file utilities
â”‚   â””â”€â”€ setup.py          # â­ Run this first
â”‚
â”œâ”€â”€ src/                  # Next.js frontend
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ api/         # Serve JSON files
â”‚   â”‚   â”‚   â”œâ”€â”€ teams/route.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ territory/route.ts
â”‚   â”‚   â”‚   â””â”€â”€ games/route.ts
â”‚   â”‚   â””â”€â”€ page.tsx     # Map page
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â””â”€â”€ Map.tsx      # MapLibre rendering
â”‚   â””â”€â”€ lib/
â”‚       â””â”€â”€ mapUtils.ts  # Client utilities
â”‚
â””â”€â”€ public/data/
    â”œâ”€â”€ us-counties.geojson  # âœ… Committed (3.1MB)
    â”œâ”€â”€ teams.json           # âš ï¸  Generated by setup.py
    â””â”€â”€ ownership.json       # âš ï¸  Generated by setup.py
```

**Only 13 source files!** (was 40+ before cleanup)

## Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Browser   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ HTTP GET /
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Next.js    â”‚
â”‚  (Vercel)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Read files
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  public/data/       â”‚
â”‚  â”œâ”€â”€ teams.json     â”‚ â—„â”€â”€ Generated by Python
â”‚  â””â”€â”€ ownership.json â”‚ â—„â”€â”€ Updated after games
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**No database, no serverless functions, just JSON files!**

## What's Next?

### To See the Map Working:
1. Run `backend/setup.py` (generates data files)
2. Run `npm run dev`
3. Open http://localhost:3000

### To Update After Games:
1. Run `python ingest_games.py --season 2025`
2. Run `python apply_transfers.py --season 2025`
3. `git add frontend/public/data && git commit && git push`
4. Vercel auto-deploys the refreshed map

### To Deploy to Production:
```bash
# Connect to Vercel
vercel

# Deploy
vercel --prod
```

That's it! No database setup, no environment variables needed.

## Troubleshooting

**Map doesn't show?**
- Check: Did `backend/setup.py` create `public/data/teams.json`?
- Check: Does `public/data/ownership.json` exist?
- Check browser console for errors

**Python errors?**
```bash
# Make sure virtual environment is activated
source venv/bin/activate

# Reinstall dependencies
pip install -r requirements.txt
```

**Build errors?**
```bash
# Clean install
rm -rf node_modules package-lock.json
npm install
```

## Files You Can Safely Delete

These are just documentation/notes, not needed for the app:
- `AGENTS.md`
- `CLAUDE.md`
- `PROJECT_STATUS.md`
- `design.md`
- `context/`

## Cost

**$0/month** using:
- Vercel Free Tier (frontend hosting)
- GitHub (JSON file storage)
- Local Python scripts (run on your machine)

No AWS, no database, no API costs!
